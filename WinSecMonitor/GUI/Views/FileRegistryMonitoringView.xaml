<UserControl x:Class="WinSecMonitor.GUI.Views.FileRegistryMonitoringView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WinSecMonitor.GUI.Views"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <!-- Styles for DataGrid -->
        <Style x:Key="DataGridColumnHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Background" Value="#2D2D30" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="8,5" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <!-- Style for High Severity Row -->
        <Style x:Key="HighSeverityRowStyle" TargetType="{x:Type DataGridRow}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Severity}" Value="High">
                    <Setter Property="Background" Value="#FFCCCC" />
                    <Setter Property="FontWeight" Value="Bold" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Style for Medium Severity Row -->
        <Style x:Key="MediumSeverityRowStyle" TargetType="{x:Type DataGridRow}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Severity}" Value="Medium">
                    <Setter Property="Background" Value="#FFFFCC" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Style for Low Severity Row -->
        <Style x:Key="LowSeverityRowStyle" TargetType="{x:Type DataGridRow}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Severity}" Value="Low">
                    <Setter Property="Background" Value="#E6F5FF" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Combine all severity styles -->
        <Style x:Key="SeverityRowStyle" TargetType="{x:Type DataGridRow}" 
               BasedOn="{StaticResource HighSeverityRowStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Severity}" Value="Medium">
                    <Setter Property="Background" Value="#FFFFCC" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Severity}" Value="Low">
                    <Setter Property="Background" Value="#E6F5FF" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with controls -->
        <Grid Grid.Row="0" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="File &amp; Registry Monitoring" FontSize="18" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="Status: " Margin="20,0,0,0" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding IsMonitoring, Converter={StaticResource BoolToStatusConverter}}" 
                           Foreground="{Binding IsMonitoring, Converter={StaticResource BoolToColorConverter}}"
                           FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text=" | " Margin="10,0" VerticalAlignment="Center"/>
                <TextBlock Text="File Changes: " VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalFileChanges}" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text=" | " Margin="10,0" VerticalAlignment="Center"/>
                <TextBlock Text="Registry Changes: " VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TotalRegistryChanges}" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text=" | " Margin="10,0" VerticalAlignment="Center"/>
                <TextBlock Text="High Severity: " VerticalAlignment="Center"/>
                <TextBlock Text="{Binding HighSeverityChanges}" Foreground="Red" FontWeight="Bold" VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="StartMonitoringButton" Content="Start Monitoring" Margin="5,0" Padding="8,3"
                        Command="{Binding StartMonitoringCommand}"
                        Visibility="{Binding IsMonitoring, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <Button x:Name="StopMonitoringButton" Content="Stop Monitoring" Margin="5,0" Padding="8,3"
                        Command="{Binding StopMonitoringCommand}"
                        Visibility="{Binding IsMonitoring, Converter={StaticResource BoolToVisibilityConverter}}"/>
                <Button x:Name="RefreshButton" Content="Refresh" Margin="5,0" Padding="8,3"
                        Command="{Binding RefreshCommand}"/>
                <Button x:Name="ClearButton" Content="Clear All" Margin="5,0" Padding="8,3"
                        Command="{Binding ClearAllCommand}"/>
            </StackPanel>
        </Grid>

        <!-- Main content with tabs -->
        <TabControl Grid.Row="1" Margin="10,0,10,10">
            <!-- File Changes Tab -->
            <TabItem Header="File Changes">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Search and filter controls -->
                    <Grid Grid.Row="0" Margin="0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" x:Name="FileSearchTextBox" Margin="0,0,10,0" Padding="5,3"
                                 Text="{Binding FileSearchText, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Search by path or change type"/>

                        <ComboBox Grid.Column="1" x:Name="FileSeverityFilterComboBox" Width="120" Margin="0,0,10,0" Padding="5,3"
                                  SelectedItem="{Binding FileSeverityFilter}"
                                  ItemsSource="{Binding SeverityFilterOptions}"/>

                        <ComboBox Grid.Column="2" x:Name="FileChangeTypeFilterComboBox" Width="120" Margin="0" Padding="5,3"
                                  SelectedItem="{Binding FileChangeTypeFilter}"
                                  ItemsSource="{Binding FileChangeTypeFilterOptions}"/>
                    </Grid>

                    <!-- File changes data grid -->
                    <DataGrid Grid.Row="1" x:Name="FileChangesDataGrid" 
                              ItemsSource="{Binding FilteredFileChanges}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              RowStyle="{StaticResource SeverityRowStyle}"
                              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                              AlternatingRowBackground="#F5F5F5"
                              RowHeaderWidth="0"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="1"
                              BorderBrush="#CCCCCC">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="150"/>
                            <DataGridTextColumn Header="Change Type" Binding="{Binding ChangeType}" Width="100"/>
                            <DataGridTextColumn Header="Path" Binding="{Binding Path}" Width="*"/>
                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="80"/>
                            <DataGridTextColumn Header="Details" Binding="{Binding Details}" Width="200"/>
                        </DataGrid.Columns>
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Export to CSV" Command="{Binding ExportFileChangesCommand}"/>
                                <MenuItem Header="Clear File Changes" Command="{Binding ClearFileChangesCommand}"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Registry Changes Tab -->
            <TabItem Header="Registry Changes">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Search and filter controls -->
                    <Grid Grid.Row="0" Margin="0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" x:Name="RegistrySearchTextBox" Margin="0,0,10,0" Padding="5,3"
                                 Text="{Binding RegistrySearchText, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Search by key path or value name"/>

                        <ComboBox Grid.Column="1" x:Name="RegistrySeverityFilterComboBox" Width="120" Margin="0,0,10,0" Padding="5,3"
                                  SelectedItem="{Binding RegistrySeverityFilter}"
                                  ItemsSource="{Binding SeverityFilterOptions}"/>

                        <ComboBox Grid.Column="2" x:Name="RegistryChangeTypeFilterComboBox" Width="120" Margin="0" Padding="5,3"
                                  SelectedItem="{Binding RegistryChangeTypeFilter}"
                                  ItemsSource="{Binding RegistryChangeTypeFilterOptions}"/>
                    </Grid>

                    <!-- Registry changes data grid -->
                    <DataGrid Grid.Row="1" x:Name="RegistryChangesDataGrid" 
                              ItemsSource="{Binding FilteredRegistryChanges}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              RowStyle="{StaticResource SeverityRowStyle}"
                              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                              AlternatingRowBackground="#F5F5F5"
                              RowHeaderWidth="0"
                              GridLinesVisibility="Horizontal"
                              BorderThickness="1"
                              BorderBrush="#CCCCCC">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="150"/>
                            <DataGridTextColumn Header="Change Type" Binding="{Binding ChangeType}" Width="100"/>
                            <DataGridTextColumn Header="Key Path" Binding="{Binding KeyPath}" Width="*"/>
                            <DataGridTextColumn Header="Value Name" Binding="{Binding ValueName}" Width="120"/>
                            <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="80"/>
                            <DataGridTextColumn Header="Old Value" Binding="{Binding OldValue}" Width="100"/>
                            <DataGridTextColumn Header="New Value" Binding="{Binding NewValue}" Width="100"/>
                        </DataGrid.Columns>
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Export to CSV" Command="{Binding ExportRegistryChangesCommand}"/>
                                <MenuItem Header="Clear Registry Changes" Command="{Binding ClearRegistryChangesCommand}"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Configuration Tab -->
            <TabItem Header="Configuration">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Configuration header -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Monitoring Configuration" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button x:Name="SaveConfigButton" Content="Save Config" Margin="5,0" Padding="8,3"
                                    Command="{Binding SaveConfigCommand}"/>
                            <Button x:Name="LoadConfigButton" Content="Load Config" Margin="5,0" Padding="8,3"
                                    Command="{Binding LoadConfigCommand}"/>
                            <Button x:Name="ResetConfigButton" Content="Reset to Defaults" Margin="5,0" Padding="8,3"
                                    Command="{Binding ResetConfigCommand}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Configuration content -->
                    <TabControl Grid.Row="1" Margin="0,10">
                        <!-- General Settings Tab -->
                        <TabItem Header="General Settings">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Enable File Monitoring:" VerticalAlignment="Center" Margin="0,5"/>
                                <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding Configuration.EnableFileMonitoring}" VerticalAlignment="Center" Margin="0,5"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Enable Registry Monitoring:" VerticalAlignment="Center" Margin="0,5"/>
                                <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding Configuration.EnableRegistryMonitoring}" VerticalAlignment="Center" Margin="0,5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Refresh Interval (seconds):" VerticalAlignment="Center" Margin="0,5"/>
                                <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,5">
                                    <Slider Minimum="1" Maximum="60" Value="{Binding Configuration.RefreshIntervalSeconds}" Width="200" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Configuration.RefreshIntervalSeconds}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Max Changes to Keep:" VerticalAlignment="Center" Margin="0,5"/>
                                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,5">
                                    <Slider Minimum="100" Maximum="10000" Value="{Binding Configuration.MaxChangesToKeep}" Width="200" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding Configuration.MaxChangesToKeep}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </TabItem>

                        <!-- Monitored Paths Tab -->
                        <TabItem Header="Monitored Paths">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Grid.Column="0" x:Name="NewPathTextBox" Margin="0,0,10,0" Padding="5,3"
                                             Text="{Binding NewPathText, UpdateSourceTrigger=PropertyChanged}"
                                             ToolTip="Enter a directory path to monitor"/>

                                    <Button Grid.Column="1" x:Name="AddPathButton" Content="Add Path" Margin="0,0,5,0" Padding="8,3"
                                            Command="{Binding AddPathCommand}"/>

                                    <Button Grid.Column="2" x:Name="BrowsePathButton" Content="Browse..." Padding="8,3"
                                            Command="{Binding BrowsePathCommand}"/>
                                </Grid>

                                <DataGrid Grid.Row="1" x:Name="MonitoredPathsDataGrid" 
                                          ItemsSource="{Binding Configuration.MonitoredPaths}"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                                          AlternatingRowBackground="#F5F5F5"
                                          RowHeaderWidth="0"
                                          GridLinesVisibility="Horizontal"
                                          BorderThickness="1"
                                          BorderBrush="#CCCCCC">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Path" Binding="{Binding}" Width="*"/>
                                        <DataGridTemplateColumn Header="Actions" Width="100">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Remove" Padding="5,2"
                                                            Command="{Binding DataContext.RemovePathCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>

                        <!-- Monitored Registry Keys Tab -->
                        <TabItem Header="Monitored Registry Keys">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox Grid.Column="0" x:Name="RegistryHiveComboBox" Width="100" Margin="0,0,10,0" Padding="5,3"
                                              SelectedItem="{Binding SelectedRegistryHive}"
                                              ItemsSource="{Binding RegistryHives}"/>

                                    <TextBox Grid.Column="1" x:Name="NewKeyPathTextBox" Margin="0,0,10,0" Padding="5,3"
                                             Text="{Binding NewKeyPathText, UpdateSourceTrigger=PropertyChanged}"
                                             ToolTip="Enter a registry key path to monitor"/>

                                    <CheckBox Grid.Column="2" x:Name="IncludeSubKeysCheckBox" Content="Include Subkeys" Margin="0,0,10,0" VerticalAlignment="Center"
                                              IsChecked="{Binding IncludeSubKeys}"/>

                                    <Button Grid.Column="3" x:Name="AddKeyButton" Content="Add Key" Padding="8,3"
                                            Command="{Binding AddKeyCommand}"/>
                                </Grid>

                                <DataGrid Grid.Row="1" x:Name="MonitoredKeysDataGrid" 
                                          ItemsSource="{Binding Configuration.MonitoredRegistryKeys}"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                                          AlternatingRowBackground="#F5F5F5"
                                          RowHeaderWidth="0"
                                          GridLinesVisibility="Horizontal"
                                          BorderThickness="1"
                                          BorderBrush="#CCCCCC">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Hive" Binding="{Binding Hive}" Width="100"/>
                                        <DataGridTextColumn Header="Key Path" Binding="{Binding SubKeyPath}" Width="*"/>
                                        <DataGridCheckBoxColumn Header="Include Subkeys" Binding="{Binding IncludeSubKeys}" Width="120"/>
                                        <DataGridTemplateColumn Header="Actions" Width="100">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Remove" Padding="5,2"
                                                            Command="{Binding DataContext.RemoveKeyCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                            CommandParameter="{Binding}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </TabItem>
                    </TabControl>

                    <!-- Configuration footer -->
                    <TextBlock Grid.Row="2" Text="Note: Changes to configuration will take effect after restarting monitoring" 
                               FontStyle="Italic" Margin="0,10,0,0"/>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status bar -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
<UserControl x:Class="WinSecMonitor.Views.EventLogCorrelationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WinSecMonitor.Views"
             xmlns:converters="clr-namespace:WinSecMonitor.Utils.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <ResourceDictionary>
            <converters:AlertSeverityToBrushConverter x:Key="AlertSeverityToBrushConverter" />
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
            <converters:EventLogLevelToBrushConverter x:Key="EventLogLevelToBrushConverter" />
            <converters:RootkitSeverityToBrushConverter x:Key="RootkitSeverityToBrushConverter" />
            
            <Style x:Key="HeaderTextBlockStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontWeight" Value="Bold" />
                <Setter Property="Margin" Value="0,10,0,5" />
            </Style>
            
            <Style x:Key="SubHeaderTextBlockStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Margin" Value="0,5,0,5" />
            </Style>
            
            <Style x:Key="StatusTextBlockStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Margin" Value="5,2,5,2" />
            </Style>
            
            <Style x:Key="ActionButtonStyle" TargetType="Button">
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="Margin" Value="5" />
                <Setter Property="MinWidth" Value="100" />
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Header with controls -->
        <Grid Grid.Row="0" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <Button x:Name="StartButton" Content="Start Monitoring" Style="{StaticResource ActionButtonStyle}" 
                        Command="{Binding StartCommand}" />
                <Button x:Name="StopButton" Content="Stop Monitoring" Style="{StaticResource ActionButtonStyle}" 
                        Command="{Binding StopCommand}" />
                <Button x:Name="RefreshButton" Content="Refresh" Style="{StaticResource ActionButtonStyle}" 
                        Command="{Binding RefreshCommand}" />
            </StackPanel>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="SettingsButton" Content="Settings" Style="{StaticResource ActionButtonStyle}" 
                        Command="{Binding OpenSettingsCommand}" />
                <Button x:Name="ExportButton" Content="Export Logs" Style="{StaticResource ActionButtonStyle}" 
                        Command="{Binding ExportLogsCommand}" />
            </StackPanel>
        </Grid>
        
        <!-- Main content -->
        <TabControl Grid.Row="1" Margin="10,0,10,10">
            <!-- Dashboard Tab -->
            <TabItem Header="Dashboard">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <!-- Status Panel -->
                    <Border Grid.Row="0" BorderBrush="#CCCCCC" BorderThickness="1" Margin="0,10,0,10" Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <!-- Collection Status -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Collection Status" Style="{StaticResource SubHeaderTextBlockStyle}" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Collection Active:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding IsCollectionActive}" Style="{StaticResource StatusTextBlockStyle}" 
                                               Foreground="{Binding IsCollectionActive, Converter={StaticResource BooleanToColorConverter}}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Log Sources:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding LogSourcesCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Entries Collected:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding CollectedEntriesCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Last Collection:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding LastCollectionTime}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Correlation Status -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Correlation Status" Style="{StaticResource SubHeaderTextBlockStyle}" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Correlation Active:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding IsCorrelationActive}" Style="{StaticResource StatusTextBlockStyle}" 
                                               Foreground="{Binding IsCorrelationActive, Converter={StaticResource BooleanToColorConverter}}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Active Rules:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding ActiveRulesCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Alerts Generated:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding AlertsCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Threat Feeds:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding ThreatFeedsCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Rootkit Detection Status -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Rootkit Detection" Style="{StaticResource SubHeaderTextBlockStyle}" />
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Detection Active:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding IsRootkitDetectionActive}" Style="{StaticResource StatusTextBlockStyle}" 
                                               Foreground="{Binding IsRootkitDetectionActive, Converter={StaticResource BooleanToColorConverter}}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Detections:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding RootkitDetectionsCount}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Last Scan:" Style="{StaticResource StatusTextBlockStyle}" />
                                    <TextBlock Text="{Binding LastRootkitScanTime}" Style="{StaticResource StatusTextBlockStyle}" />
                                </StackPanel>
                                <Button Content="Scan Now" Command="{Binding ScanForRootkitsCommand}" 
                                        Margin="0,5,0,0" Padding="5,2" />
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Alerts Panel -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Recent Alerts" Style="{StaticResource HeaderTextBlockStyle}" />
                        
                        <DataGrid Grid.Row="1" ItemsSource="{Binding RecentAlerts}" AutoGenerateColumns="False" 
                                  IsReadOnly="True" AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="150" />
                                <DataGridTextColumn Header="Rule" Binding="{Binding RuleName}" Width="150" />
                                <DataGridTemplateColumn Header="Severity" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Severity}" 
                                                       Foreground="{Binding Severity, Converter={StaticResource AlertSeverityToBrushConverter}}" />
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>
            
            <!-- Event Logs Tab -->
            <TabItem Header="Event Logs">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <!-- Controls -->
                    <Grid Grid.Row="0" Margin="0,10,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Log Source:" VerticalAlignment="Center" Margin="0,0,5,0" />
                            <ComboBox Width="150" ItemsSource="{Binding LogSources}" SelectedItem="{Binding SelectedLogSource}" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="Filter:" VerticalAlignment="Center" Margin="10,0,5,0" />
                            <TextBox Width="200" Text="{Binding LogFilter, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Content="Apply" Command="{Binding ApplyLogFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                            <Button Content="Clear" Command="{Binding ClearLogFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="Refresh Logs" Command="{Binding RefreshLogsCommand}" Padding="5,2" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Event Log Entries -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredEventLogs}" AutoGenerateColumns="False" 
                              IsReadOnly="True" AlternatingRowBackground="#F5F5F5">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="150" />
                            <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="120" />
                            <DataGridTextColumn Header="Event ID" Binding="{Binding EventId}" Width="80" />
                            <DataGridTemplateColumn Header="Level" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Level}" 
                                                   Foreground="{Binding Level, Converter={StaticResource EventLogLevelToBrushConverter}}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
            
            <!-- Correlation Alerts Tab -->
            <TabItem Header="Correlation Alerts">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <!-- Controls -->
                    <Grid Grid.Row="0" Margin="0,10,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Severity:" VerticalAlignment="Center" Margin="0,0,5,0" />
                            <ComboBox Width="120" ItemsSource="{Binding AlertSeverities}" SelectedItem="{Binding SelectedAlertSeverity}" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="Filter:" VerticalAlignment="Center" Margin="10,0,5,0" />
                            <TextBox Width="200" Text="{Binding AlertFilter, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Content="Apply" Command="{Binding ApplyAlertFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                            <Button Content="Clear" Command="{Binding ClearAlertFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="Export Alerts" Command="{Binding ExportAlertsCommand}" Padding="5,2" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Correlation Alerts -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredCorrelationAlerts}" AutoGenerateColumns="False" 
                              IsReadOnly="True" AlternatingRowBackground="#F5F5F5" 
                              SelectedItem="{Binding SelectedCorrelationAlert}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding Timestamp}" Width="150" />
                            <DataGridTextColumn Header="Rule" Binding="{Binding RuleName}" Width="150" />
                            <DataGridTemplateColumn Header="Severity" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Severity}" 
                                                   Foreground="{Binding Severity, Converter={StaticResource AlertSeverityToBrushConverter}}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                    
                    <!-- Alert Details -->
                    <Expander Grid.Row="2" Header="Alert Details" IsExpanded="False" Margin="0,10,0,0">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Rule Type:" FontWeight="Bold" Margin="0,0,10,5" />
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedCorrelationAlert.RuleType}" Margin="0,0,0,5" />
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Timestamp:" FontWeight="Bold" Margin="0,0,10,5" />
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedCorrelationAlert.Timestamp}" Margin="0,0,0,5" />
                            
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Related Events:" FontWeight="Bold" Margin="0,0,10,5" VerticalAlignment="Top" />
                            <ListBox Grid.Row="2" Grid.Column="1" ItemsSource="{Binding SelectedCorrelationAlert.RelatedEvents}" 
                                     MaxHeight="200" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" TextWrapping="Wrap" />
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </Expander>
                </Grid>
            </TabItem>
            
            <!-- Threat Intelligence Tab -->
            <TabItem Header="Threat Intelligence">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <!-- Controls -->
                    <Grid Grid.Row="0" Margin="0,10,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Feed Type:" VerticalAlignment="Center" Margin="0,0,5,0" />
                            <ComboBox Width="150" ItemsSource="{Binding ThreatFeedTypes}" SelectedItem="{Binding SelectedThreatFeedType}" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="10,0,5,0" />
                            <TextBox Width="200" Text="{Binding ThreatIntelligenceSearch, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Content="Search" Command="{Binding SearchThreatIntelligenceCommand}" Margin="5,0,0,0" Padding="5,2" />
                            <Button Content="Clear" Command="{Binding ClearThreatIntelligenceSearchCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="Update Feeds" Command="{Binding UpdateThreatFeedsCommand}" Padding="5,2" />
                            <Button Content="Add Feed" Command="{Binding AddThreatFeedCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Threat Intelligence Data -->
                    <TabControl Grid.Row="1">
                        <!-- Malicious IPs Tab -->
                        <TabItem Header="Malicious IPs" Visibility="{Binding IsMaliciousIPsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <DataGrid ItemsSource="{Binding MaliciousIPs}" AutoGenerateColumns="False" 
                                      IsReadOnly="True" AlternatingRowBackground="#F5F5F5">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="IP Address" Binding="{Binding IPAddress}" Width="150" />
                                    <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="120" />
                                    <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="120" />
                                    <DataGridTextColumn Header="Last Updated" Binding="{Binding LastUpdated}" Width="150" />
                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                        
                        <!-- Malware Hashes Tab -->
                        <TabItem Header="Malware Hashes" Visibility="{Binding IsMalwareHashesVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <DataGrid ItemsSource="{Binding MalwareHashes}" AutoGenerateColumns="False" 
                                      IsReadOnly="True" AlternatingRowBackground="#F5F5F5">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Hash" Binding="{Binding Hash}" Width="300" />
                                    <DataGridTextColumn Header="Type" Binding="{Binding HashType}" Width="80" />
                                    <DataGridTextColumn Header="Malware Name" Binding="{Binding MalwareName}" Width="150" />
                                    <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="120" />
                                    <DataGridTextColumn Header="Last Updated" Binding="{Binding LastUpdated}" Width="150" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                        
                        <!-- CVEs Tab -->
                        <TabItem Header="CVEs" Visibility="{Binding IsCVEsVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <DataGrid ItemsSource="{Binding CVEs}" AutoGenerateColumns="False" 
                                      IsReadOnly="True" AlternatingRowBackground="#F5F5F5">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="CVE ID" Binding="{Binding CveId}" Width="120" />
                                    <DataGridTemplateColumn Header="Severity" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Severity}" 
                                                           Foreground="{Binding Severity, Converter={StaticResource CVESeverityToBrushConverter}}" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Published" Binding="{Binding PublishedDate}" Width="120" />
                                    <DataGridTextColumn Header="Last Modified" Binding="{Binding LastModifiedDate}" Width="120" />
                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                        
                        <!-- Feeds Tab -->
                        <TabItem Header="Configured Feeds">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                
                                <DataGrid Grid.Row="0" ItemsSource="{Binding ThreatFeeds}" AutoGenerateColumns="False" 
                                          IsReadOnly="True" AlternatingRowBackground="#F5F5F5" 
                                          SelectedItem="{Binding SelectedThreatFeed}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150" />
                                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" />
                                        <DataGridTextColumn Header="Format" Binding="{Binding Format}" Width="100" />
                                        <DataGridTextColumn Header="URL" Binding="{Binding Url}" Width="*" />
                                        <DataGridTextColumn Header="Last Updated" Binding="{Binding LastUpdated}" Width="150" />
                                        <DataGridTextColumn Header="Items" Binding="{Binding ItemCount}" Width="80" />
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Update Selected" Command="{Binding UpdateSelectedFeedCommand}" 
                                            Margin="0,0,5,0" Padding="5,2" />
                                    <Button Content="Remove" Command="{Binding RemoveThreatFeedCommand}" 
                                            Margin="0,0,5,0" Padding="5,2" />
                                </StackPanel>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            
            <!-- Rootkit Detection Tab -->
            <TabItem Header="Rootkit Detection" Visibility="{Binding IsRootkitDetectionEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <!-- Controls -->
                    <Grid Grid.Row="0" Margin="0,10,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Detection Type:" VerticalAlignment="Center" Margin="0,0,5,0" />
                            <ComboBox Width="150" ItemsSource="{Binding RootkitDetectionTypes}" SelectedItem="{Binding SelectedRootkitDetectionType}" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="Filter:" VerticalAlignment="Center" Margin="10,0,5,0" />
                            <TextBox Width="200" Text="{Binding RootkitFilter, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Content="Apply" Command="{Binding ApplyRootkitFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                            <Button Content="Clear" Command="{Binding ClearRootkitFilterCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <Button Content="Scan Now" Command="{Binding ScanForRootkitsCommand}" Padding="5,2" />
                            <Button Content="Export Results" Command="{Binding ExportRootkitResultsCommand}" Margin="5,0,0,0" Padding="5,2" />
                        </StackPanel>
                    </Grid>
                    
                    <!-- Rootkit Detections -->
                    <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredRootkitDetections}" AutoGenerateColumns="False" 
                              IsReadOnly="True" AlternatingRowBackground="#F5F5F5" 
                              SelectedItem="{Binding SelectedRootkitDetection}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Time" Binding="{Binding DetectionTime}" Width="150" />
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="150" />
                            <DataGridTemplateColumn Header="Severity" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Severity}" 
                                                   Foreground="{Binding Severity, Converter={StaticResource RootkitSeverityToBrushConverter}}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="200" />
                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                    
                    <!-- Scan Configuration -->
                    <Expander Grid.Row="2" Header="Scan Configuration" IsExpanded="False" Margin="0,10,0,0">
                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <CheckBox Content="Scan for hidden processes" IsChecked="{Binding ScanHiddenProcesses}" Margin="0,5" />
                                <CheckBox Content="Scan for hidden files" IsChecked="{Binding ScanHiddenFiles}" Margin="0,5" />
                                <CheckBox Content="Scan for hidden registry entries" IsChecked="{Binding ScanHiddenRegistry}" Margin="0,5" />
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1">
                                <CheckBox Content="Scan for SSDT hooks (requires admin)" IsChecked="{Binding ScanSSDTHooks}" Margin="0,5" />
                                <CheckBox Content="Scan for kernel hooks (requires admin)" IsChecked="{Binding ScanKernelHooks}" Margin="0,5" />
                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <TextBlock Text="Scan interval (minutes):" VerticalAlignment="Center" Margin="0,0,5,0" />
                                    <TextBox Width="50" Text="{Binding ScanIntervalMinutes}" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Expander>
                </Grid>
            </TabItem>
            
            <!-- Settings Tab -->
            <TabItem Header="Settings">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <!-- General Settings -->
                        <TextBlock Text="General Settings" Style="{StaticResource HeaderTextBlockStyle}" />
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Auto-start monitoring:" Margin="0,5,10,5" />
                            <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding AutoStartMonitoring}" VerticalAlignment="Center" />
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Collection interval (seconds):" Margin="0,5,10,5" />
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding CollectionIntervalSeconds}" Width="100" HorizontalAlignment="Left" />
                            
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Enable rootkit detection:" Margin="0,5,10,5" />
                            <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding EnableRootkitDetection}" VerticalAlignment="Center" />
                            
                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Export path:" Margin="0,5,10,5" />
                            <Grid Grid.Row="3" Grid.Column="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding ExportPath}" />
                                <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseExportPathCommand}" Margin="5,0,0,0" Padding="5,0" />
                            </Grid>
                        </Grid>
                        
                        <!-- Event Log Sources -->
                        <TextBlock Text="Event Log Sources" Style="{StaticResource HeaderTextBlockStyle}" />
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            
                            <ListBox Grid.Row="0" Grid.Column="0" ItemsSource="{Binding ConfiguredLogSources}" 
                                     SelectionMode="Extended" Height="150" Margin="0,5,5,5" />
                            
                            <StackPanel Grid.Row="0" Grid.Column="1">
                                <Button Content="Add" Command="{Binding AddLogSourceCommand}" Width="80" Margin="0,5,0,5" />
                                <Button Content="Remove" Command="{Binding RemoveLogSourceCommand}" Width="80" Margin="0,5,0,5" />
                            </StackPanel>
                            
                            <Grid Grid.Row="1" Grid.Column="0" Margin="0,5,5,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding NewLogSource}" />
                                <Button Grid.Column="1" Content="Add" Command="{Binding AddCustomLogSourceCommand}" Margin="5,0,0,0" Padding="10,0" />
                            </Grid>
                        </Grid>
                        
                        <!-- Correlation Rules -->
                        <TextBlock Text="Correlation Rules" Style="{StaticResource HeaderTextBlockStyle}" />
                        <DataGrid ItemsSource="{Binding CorrelationRules}" AutoGenerateColumns="False" 
                                  Height="200" Margin="0,5,0,20" AlternatingRowBackground="#F5F5F5" 
                                  SelectedItem="{Binding SelectedCorrelationRule}">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding IsEnabled}" Width="60" />
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" />
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Add Rule" Command="{Binding AddCorrelationRuleCommand}" Margin="0,0,5,0" Padding="5,2" />
                            <Button Content="Edit Rule" Command="{Binding EditCorrelationRuleCommand}" Margin="0,0,5,0" Padding="5,2" />
                            <Button Content="Remove Rule" Command="{Binding RemoveCorrelationRuleCommand}" Padding="5,2" />
                        </StackPanel>
                        
                        <!-- Threat Intelligence Feeds -->
                        <TextBlock Text="Threat Intelligence Feeds" Style="{StaticResource HeaderTextBlockStyle}" />
                        <DataGrid ItemsSource="{Binding ThreatFeeds}" AutoGenerateColumns="False" 
                                  Height="200" Margin="0,5,0,20" AlternatingRowBackground="#F5F5F5" 
                                  SelectedItem="{Binding SelectedThreatFeed}">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding IsEnabled}" Width="60" />
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150" />
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" />
                                <DataGridTextColumn Header="Format" Binding="{Binding Format}" Width="100" />
                                <DataGridTextColumn Header="URL" Binding="{Binding Url}" Width="*" />
                                <DataGridTextColumn Header="Update Interval (hours)" Binding="{Binding UpdateIntervalHours}" Width="150" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Add Feed" Command="{Binding AddThreatFeedCommand}" Margin="0,0,5,0" Padding="5,2" />
                            <Button Content="Edit Feed" Command="{Binding EditThreatFeedCommand}" Margin="0,0,5,0" Padding="5,2" />
                            <Button Content="Remove Feed" Command="{Binding RemoveThreatFeedCommand}" Padding="5,2" />
                        </StackPanel>
                        
                        <!-- Save Settings -->
                        <Button Content="Save Settings" Command="{Binding SaveSettingsCommand}" 
                                HorizontalAlignment="Right" Margin="0,20,0,0" Padding="10,5" />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>